<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Christmas</title>

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #02030a;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo",
          "Noto Sans KR", sans-serif;
        color: white;
      }

      /* ===== SCENE ===== */
      .scene {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        perspective: 1000px;
      }

      /* ===== TREE ===== */
      .tree {
        position: relative;
        width: 360px;
        height: 460px;
        transform-style: preserve-3d;
        animation: spin 22s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotateY(0deg);
        }
        to {
          transform: rotateY(360deg);
        }
      }

      /* ===== PARTICLES ===== */
      .star,
      .tstar {
        position: absolute;
        width: 4px;
        height: 4px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 6px rgba(255, 255, 255, 0.9),
          0 0 14px rgba(255, 255, 255, 0.6);
        opacity: 0.25;
        animation: twinkle ease-in-out infinite;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.25;
        }
        50% {
          opacity: 1;
        }
      }

      /* ===== TEXT CANVAS ===== */
      .text-canvas {
        position: relative;
        width: 420px;
        height: 120px;
        margin-top: 30px;
      }

      /* ===== TEXT PARTICLE MOVE ===== */
      @keyframes toText {
        from {
          transform: translate3d(var(--sx), var(--sy), 0);
          opacity: 0;
        }
        to {
          transform: translate3d(var(--tx), var(--ty), 0);
          opacity: 1;
        }
      }
    </style>
  </head>

  <body>
    <div class="scene">
      <div class="tree" id="tree"></div>
      <div class="text-canvas" id="text"></div>
    </div>

    <script>
      /* ===== TREE PARTICLES ===== */
      const tree = document.getElementById("tree");
      for (let i = 0; i < 520; i++) {
        const s = document.createElement("div");
        s.className = "star";

        const y = Math.random();
        const r = y * 160;
        const a = Math.random() * Math.PI * 2;

        s.style.transform = `translate3d(${Math.cos(a) * r}px, ${y * 420}px, ${
          Math.sin(a) * r
        }px)`;
        s.style.animationDuration = 1.8 + Math.random() * 2.4 + "s";
        s.style.animationDelay = Math.random() * 3 + "s";
        tree.appendChild(s);
      }

      /* ===== TEXT PARTICLES ===== */
      const textCanvas = document.getElementById("text");
      const text = "사랑해 승아야♥ 메리 크리스마스";
      const fontSize = 30;

      /* offscreen canvas */
      const c = document.createElement("canvas");
      c.width = 420;
      c.height = 120;
      const ctx = c.getContext("2d");
      ctx.fillStyle = "white";
      ctx.font = `700 ${fontSize}px Pretendard`;
      ctx.textAlign = "center";
      ctx.fillText(text, 210, 70);

      const data = ctx.getImageData(0, 0, c.width, c.height).data;

      setTimeout(() => {
        for (let y = 0; y < c.height; y += 4) {
          for (let x = 0; x < c.width; x += 4) {
            const i = (y * c.width + x) * 4;
            if (data[i] > 200) {
              const p = document.createElement("div");
              p.className = "tstar";

              // start scattered
              p.style.setProperty("--sx", Math.random() * 600 - 300 + "px");
              p.style.setProperty("--sy", Math.random() * 200 - 100 + "px");

              // target position
              p.style.setProperty("--tx", x + "px");
              p.style.setProperty("--ty", y + "px");

              p.style.animation = `toText 1.8s ease forwards, twinkle 2.6s infinite`;
              p.style.animationDelay = Math.random() * 0.6 + "s";

              textCanvas.appendChild(p);
            }
          }
        }
      }, 2200);
    </script>
  </body>
</html>
